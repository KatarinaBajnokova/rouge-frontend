import{r as c,j as e,C as E,D as z,E as _,n as I}from"./react-BNfDklOQ.js";import{B as T}from"./BasketButton-r1-1MTRa.js";import{A as R,B as D}from"./index-Cd1dwsJR.js";/* empty css                         */import{e as a,i as w,T as x,j as N,d as L,R as y,B as S,D as $,n as b}from"./mantine-BDZ4NO2A.js";import"./vendor-DRc0kkrK.js";function A({itemId:s}){const[t,r]=c.useState([]),[n,h]=c.useState(!0),[u,l]=c.useState(null),[m,g]=c.useState([]);c.useEffect(()=>{fetch(`/api/items/${s}`).then(i=>{if(!i.ok)throw new Error(`Status ${i.status}`);return i.json()}).then(i=>{const d=Array.isArray(i.images)?i.images:[];r(d)}).catch(i=>l(i.message)).finally(()=>h(!1))},[s]);const f=i=>{g(d=>[...d,i])};return n?e.jsx(a,{children:"Loading images…"}):u?e.jsxs(a,{color:"red",children:["Error: ",u]}):!t||t.length===0?e.jsx(a,{children:"No images available."}):e.jsx(w,{withControls:!1,height:300,slideSize:"50%",slideGap:0,align:"start",breakpoints:[{maxWidth:"sm",slideSize:"100%"}],children:t.map((i,d)=>e.jsx(w.Slide,{children:e.jsxs("div",{className:"carousel-image-wrapper",children:[!m.includes(d)&&e.jsx("div",{className:"image-skeleton"}),e.jsx("img",{src:i.url,alt:`Slide ${d+1}`,loading:"lazy",onLoad:()=>f(d),style:{width:"100%",height:"100%",objectFit:"cover",opacity:m.includes(d)?1:0,transition:"opacity 0.3s ease",position:"absolute",top:0,left:0}})]})},i.id||d))})}function F({itemId:s}){return e.jsx("section",{className:"detail-carousel",children:e.jsx(A,{itemId:s})})}function O({item:s,expanded:t,setExpanded:r}){var u;if(!s)return null;const n=s.description||"",h=n.slice(0,180)+(n.length>180?"…":"");return e.jsxs("section",{className:"detail-info",children:[e.jsx(x,{order:2,children:s.name}),e.jsx(N,{size:"lg",color:s.level==="Easy"?"green":s.level==="Moderate"?"blue":"red",variant:"light",mt:"xs",children:s.level}),((u=s.tags)==null?void 0:u.length)>0&&e.jsx("div",{className:"detail-tags",children:s.tags.map(l=>e.jsx(N,{size:"xs",variant:"filled",radius:"sm",className:"detail-tag",children:l},l))}),e.jsxs("div",{className:`detail-description ${t?"expanded":""}`,children:[e.jsx(a,{children:t?n:h}),n.length>180&&e.jsxs("button",{onClick:()=>r(!t),className:"toggle-desc-btn",children:[t?e.jsx(E,{size:20}):e.jsx(z,{size:20}),e.jsx("span",{children:t?"Show less":"Show more"})]})]})]})}function P({boxProducts:s}){return s!=null&&s.length?e.jsxs("section",{className:"detail-box-products",children:[e.jsx(x,{className:"detail-title",order:3,children:"Box products"}),e.jsx("div",{className:"box-products-list",children:s.map(t=>e.jsxs("div",{className:"box-product-card",children:[e.jsx("img",{src:t.image_url,alt:t.description,className:"box-product-card__img"}),e.jsxs("div",{className:"box-product-card__body",children:[e.jsx(a,{fw:700,children:t.title}),e.jsx(a,{size:"sm",color:"dimmed",mt:"xs",children:t.description})]})]},t.id))})]}):null}function U({tutorialUrl:s,poster:t}){return s?e.jsxs("section",{className:"detail-tutorial",children:[e.jsx(x,{className:"detail-title",order:3,children:"Tutorial preview"}),e.jsx("video",{src:s,controls:!0,poster:t,className:"detail-video",preload:"metadata",width:"100%",children:e.jsx(a,{component:"p",children:"Your browser does not support the video tag."})})]}):null}function G({instructions:s}){return s!=null&&s.length?e.jsxs("section",{className:"detail-instructions",children:[e.jsx(x,{className:"detail-title",order:3,children:"Instructions preview"}),e.jsx("div",{className:"instructions-list",children:s.map((t,r)=>e.jsxs("div",{className:"instruction-step",children:[e.jsxs("span",{className:"instruction-step__number",children:[r+1,"."]}),e.jsxs("div",{className:"instruction-step__body",children:[e.jsx(a,{fw:500,children:t.title}),e.jsx(a,{size:"sm",color:"dimmed",mt:2,children:t.text})]})]},r))})]}):null}function J({reviews:s=[],showReviews:t,setShowReviews:r}){const n=s.length,h=n===0?0:s.reduce((l,m)=>l+m.rating,0)/n,u=h.toFixed(1).replace(".",",");return e.jsxs("section",{className:"detail-reviews",children:[e.jsx(x,{className:"detail-title",order:3,children:"Reviews"}),!t&&e.jsx(L,{withBorder:!0,shadow:"sm",p:"lg",radius:"lg",className:"reviews-summary",mt:"sm",children:e.jsxs("div",{className:"reviews-summary-content",children:[e.jsx(x,{order:2,children:u}),e.jsx(y,{value:h,readOnly:!0,fractions:10,size:"lg",color:"grape"}),e.jsxs(a,{fw:500,mt:"xs",children:[n," ",n===1?"rating":"ratings"]}),n>0&&e.jsx(S,{size:"sm",radius:"xl",mt:"sm",color:"grape",onClick:()=>r(!0),children:"See reviews ›"})]})}),t&&e.jsxs(e.Fragment,{children:[s.length>0?s.map(l=>e.jsxs("div",{className:"review-card",children:[e.jsxs("div",{className:"review-header",children:[e.jsx(a,{fw:700,children:l.author}),e.jsx(y,{value:l.rating,readOnly:!0,size:"sm",fractions:10,color:"grape"})]}),e.jsx(a,{mt:"xs",children:l.comment}),e.jsx($,{my:"sm"})]},l.id)):e.jsx(a,{children:"No reviews yet."}),e.jsx(S,{variant:"subtle",radius:"xl",size:"xs",onClick:()=>r(!1),children:"‹ Back to summary"})]})]})}function M({item:s,handleAddToBasket:t}){return e.jsx("div",{className:"purchase-banner",children:e.jsxs("div",{className:"purchase-banner__content",children:[e.jsxs("div",{className:"purchase-banner__price",children:[e.jsx(a,{fw:500,size:"sm",children:"Price:"}),e.jsxs(a,{fw:900,size:"lg",children:["€",s.price.toFixed(2).replace(".",",")]})]}),e.jsx(R,{onClick:t})]})})}function V(){var v;const{id:s}=_(),t=Number(s);I();const[r,n]=c.useState(null),[h,u]=c.useState(!0),[l,m]=c.useState(null),[g,f]=c.useState(!1),[i,d]=c.useState(!1),[k,B]=c.useState(0);c.useEffect(()=>{fetch(`/api/item_detail?id=${t}`).then(async o=>{if(!o.ok){const j=await o.text();throw new Error(`Item not found: ${j}`)}const p=o.headers.get("Content-Type");if(!p||!p.includes("application/json")){const j=await o.text();throw new Error(`Unexpected response: ${j}`)}return o.json()}).then(o=>n(o)).catch(o=>m(o.message)).finally(()=>u(!1))},[t]);const C=async()=>{if(r)try{const o=await fetch("/api/basket",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({item_id:r.id})}),p=await o.json();if(!o.ok)throw new Error(p.error||"Failed to add to basket");b.show({title:"Item added to basket",message:`${r.name} has been added.`,color:"grape",autoClose:2e3,withCloseButton:!1}),B(j=>j+1)}catch{b.show({title:"Error",message:"Could not add item to basket.",color:"red",autoClose:3e3})}};return h?e.jsx(a,{children:"Loading…"}):l?e.jsxs(a,{color:"red",children:["Error: ",l]}):e.jsxs("div",{className:"product-detail",children:[e.jsxs("div",{className:"detail-header-buttons",children:[e.jsx(D,{style:{position:"fixed"}}),e.jsx(T,{refresh:k})]}),e.jsx(F,{itemId:t}),e.jsx(O,{item:r,expanded:g,setExpanded:f}),e.jsx(P,{boxProducts:r.boxProducts}),e.jsx(U,{tutorialUrl:r.tutorialUrl,poster:(v=r.images)==null?void 0:v[0]}),e.jsx(G,{instructions:r.instructions}),e.jsx(J,{reviews:r.reviews,showReviews:i,setShowReviews:d}),e.jsx(M,{item:r,handleAddToBasket:C})]})}export{V as default};
