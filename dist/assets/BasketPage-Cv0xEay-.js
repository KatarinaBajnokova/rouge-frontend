import{I,t as N,v as _,j as e,w as B,x as E,P as M,n as f,r as p,u as L,G as v,a2 as q,Y as a,l as F,a3 as j,Z as P,C as T}from"./index-BwPW9mmE.js";import{I as V}from"./Image-BJWYdlJl.js";var C={root:"m_6d731127"};const z={gap:"md",align:"stretch",justify:"flex-start"},O=E((c,{gap:r,align:l,justify:i})=>({root:{"--stack-gap":M(r),"--stack-align":l,"--stack-justify":i}})),y=I((c,r)=>{const l=N("Stack",z,c),{classNames:i,className:u,style:h,styles:g,unstyled:o,vars:d,align:w,justify:x,gap:k,variant:m,...s}=l,t=_({name:"Stack",props:l,classes:C,className:u,style:h,classNames:i,styles:g,unstyled:o,vars:d,varsResolver:O});return e.jsx(B,{ref:r,...t("root"),variant:m,...s})});y.classes=C;y.displayName="@mantine/core/Stack";/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var J=f("outline","minus","IconMinus",[["path",{d:"M5 12l14 0",key:"svg-0"}]]);/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var R=f("outline","plus","IconPlus",[["path",{d:"M12 5l0 14",key:"svg-0"}],["path",{d:"M5 12l14 0",key:"svg-1"}]]);/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Y=f("outline","trash","IconTrash",[["path",{d:"M4 7l16 0",key:"svg-0"}],["path",{d:"M10 11l0 6",key:"svg-1"}],["path",{d:"M14 11l0 6",key:"svg-2"}],["path",{d:"M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12",key:"svg-3"}],["path",{d:"M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3",key:"svg-4"}]]);const H="data:image/svg+xml,%3csvg%20width='289'%20height='288'%20viewBox='0%200%20289%20288'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M214.557%20236.72H73.1238C70.9534%20236.733%2068.8551%20235.942%2067.2338%20234.499C65.6125%20233.056%2064.5832%20231.064%2064.3445%20228.906L57.409%20124.829C57.3724%20123.666%2057.5744%20122.508%2058.0027%20121.426C58.431%20120.345%2059.0763%20119.362%2059.8989%20118.54C60.7215%20117.717%2061.7041%20117.072%2062.7858%20116.643C63.8674%20116.215%2065.0254%20116.013%2066.1882%20116.05H222.941C225.27%20116.05%20227.503%20116.975%20229.149%20118.621C230.796%20120.267%20231.721%20122.5%20231.721%20124.829L223.336%20228.994C223.078%20231.135%20222.04%20233.107%20220.42%20234.532C218.801%20235.956%20216.714%20236.735%20214.557%20236.72Z'%20stroke='%23959595'%20stroke-width='13'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M100.647%20144.539V96.253C100.647%2084.611%20105.272%2073.4459%20113.504%2065.2138C121.736%2056.9817%20132.901%2052.3569%20144.543%2052.3569C156.185%2052.3569%20167.35%2056.9817%20175.582%2065.2138C183.815%2073.4459%20188.439%2084.611%20188.439%2096.253V144.539'%20stroke='%23959595'%20stroke-width='13'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e";function Z(){const[c,r]=p.useState([]),[l,i]=p.useState(0),[u,h]=p.useState(!0),g=L(),o="basket",d=()=>{localStorage.getItem("resetBasket")!=="true"&&(h(!0),fetch("/api/basket").then(t=>t.json()).then(t=>{const n=t.items||[];r(n),i(t.total_price||0),localStorage.setItem(o,JSON.stringify(n))}).catch(t=>console.error("Failed to fetch basket:",t)).finally(()=>h(!1)))};p.useEffect(()=>{if(localStorage.getItem("resetBasket")==="true")localStorage.removeItem(o),r([]),i(0),localStorage.removeItem("resetBasket");else{const n=JSON.parse(localStorage.getItem(o)||"null");n&&(r(n),i(n.reduce((S,b)=>S+b.price*b.quantity,0)))}d();const t=n=>{n.key===o&&(n.newValue?d():(r([]),i(0)))};return window.addEventListener("storage",t),()=>window.removeEventListener("storage",t)},[]);const w=async s=>{await fetch(`/api/basket/${s}`,{method:"DELETE"}),d()},x=async(s,t)=>{t<1||t>10||(await fetch(`/api/basket/${s}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({quantity:t})}),d())},k=4.99,m=(l+k).toFixed(2).replace(".",",");return u?e.jsxs(v,{position:"center",mt:"lg",children:[e.jsx(q,{}),e.jsx(a,{children:"Loading basket…"})]}):e.jsxs("div",{className:"basket-page",children:[e.jsx(F,{text:"Shopping Basket"}),c.length===0?e.jsxs("div",{className:"empty-basket",children:[e.jsx("img",{src:H,alt:"Empty basket"}),e.jsx("p",{children:"Your basket is empty."})]}):e.jsxs(e.Fragment,{children:[e.jsx(a,{fw:700,mt:"md",mb:"xs",children:"Your items"}),e.jsx(y,{spacing:"sm",children:c.map(s=>e.jsxs("div",{className:"basket-card",children:[e.jsx(V,{src:s.image_url,radius:"md"}),e.jsxs("div",{className:"basket-card__info",children:[e.jsxs("div",{className:"basket-card__text",children:[e.jsx(a,{fw:700,children:s.name}),e.jsx(a,{size:"sm",c:"dimmed",children:s.category}),e.jsx(a,{size:"xs",c:"green",children:s.level})]}),e.jsx(j,{className:"trash-icon",onClick:()=>w(s.id),children:e.jsx(Y,{size:18})}),e.jsxs("div",{className:"basket-card__buttons",children:[e.jsx("div",{className:"basket-card__price",children:e.jsxs(a,{fw:700,children:["€",(s.price*s.quantity).toFixed(2).replace(".",",")]})}),e.jsx("div",{className:"basket-card__quantity",children:e.jsxs(v,{spacing:6,children:[e.jsx(j,{variant:"default",radius:"xl",onClick:()=>x(s.id,s.quantity-1),disabled:s.quantity<=1,children:e.jsx(J,{size:14})}),e.jsx(a,{fw:500,children:s.quantity}),e.jsx(j,{variant:"default",radius:"xl",onClick:()=>x(s.id,s.quantity+1),disabled:s.quantity>=10,children:e.jsx(R,{size:14})})]})})]})]})]},s.id))}),e.jsxs(v,{className:"basket-footer",position:"apart",align:"flex-end",children:[e.jsxs("div",{className:"basket-footer__left",children:[e.jsx(a,{size:"16px",fw:500,children:"Shipping:"}),e.jsxs(a,{size:"20px",mt:"xs",c:"dimmed",children:["€",k.toFixed(2).replace(".",",")]}),e.jsx(a,{mt:"xs",fw:700,children:"Total:"}),e.jsxs(P,{order:2,mt:-6,children:["€",m]})]}),e.jsx(T,{onClick:()=>{localStorage.removeItem(o),window.dispatchEvent(new StorageEvent("storage",{key:o,oldValue:JSON.stringify(c),newValue:null})),g("/checkout/personal-info")}})]})]})]})}export{Z as default};
